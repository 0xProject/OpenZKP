# Polynomials

## Fast extrapolation from ⟨ω⟩

Given $P ∈ \F[X]$ with $\deg P < n$ and $ω$ a $n$-primitive root of unity. Evaluate $P$ on the subgroup generated by $ω$:

$$
a_i = P(ω^i)
$$

**Goal.** *Given only $a_i$ and arbitrary $z ∈ \F$, efficiently evaluate $P(z)$.*

---

Observe the Lagrange basis for $⟨ω⟩$:

$$
L_i(X) = c_i \frac{X^n - 1}{X-ω^i}
$$

where $c_i$ is set such that $L_i(ω^j) = \delta_{ij}$ (i.e. one when $i=j$ and zero otherwise). Using L'Hospital rule we find:

$$
\left. \frac{X^n - 1}{X-ω^i} \right\vert_{X=ω^i} =
\left. \frac{n⋅X^{n-1}}{1} \right\vert_{X=ω^i} =
n ⋅ ω^{i(n-1)} =
\frac{n}{ω^i}
$$

and thus

$$
L_i(X) = \frac{ω^i}{n} \frac{X^n - 1}{X-ω^i}
$$

---

$$
\begin{aligned}
P(z) &= 
\sum_i a_i ⋅ L_i(z) \\\\&=
\sum_i a_i ⋅ \frac{ω^i}{n} \frac{z^n - 1}{z - ω^i} \\\\&=
\frac{z^n - 1}{n} \sum_i \frac{a_i ⋅ ω^i}{z - ω^i}
\end{aligned}
$$

This can be evaluated in $\mathcal{O}(1)$ space and $\mathcal{O}(m + \log n)$ time, where $m$ is the number of non-zero entries in $\vec a$.

## L'Hospital rules in finite fields

$$
\gdef\diff#1{\frac{\delta}{\delta #1}}
$$

**Warning.** "I have only proved it correct, not tried it."

Given $P,Q ∈ \F[X]$. Consider the fraction

$$
\frac{P(X)}{Q(X)}
$$

If this fraction is $\frac 00$ indeterminate in some value $α ∈ \F$, we can elliminate the zeros we found:

$$
\frac{P(X)/(X - α)}{Q(X)/(X - α)}
$$

If necessary we can repeat this untill the fraction is no longer indeterminate.

In real numbers, there is an alternative trick, where instead we differentiate the numbers:

$$
\frac{\diff X P(X)}{\diff X Q(X)}
$$

again, repeated as necessary. This trick can be applied in Finite Fields too, if we use formal derivatives.

Intuition suggest that L'Hospital's rule should give the same result at $X = α$. This essentially boils down to the following identity:

---

**Lemma.** *Given $P,Q ∈ \F[X]$ and $α ∈ \F$, then*

$$
\left. \frac{\diff X P(X)}{\diff X Q(X)} \right\vert_{X = α} =
\left. \frac{P(X)/(X - α)}{Q(X)/(X - α)} \right\vert_{X = α}
$$

*Proof.* Follows directly from below lemma.

---

**Lemma.** *Given $P ∈ \F[X]$ and $α ∈ \F$ with $P(α) = 0$ then*

$$
\left. \diff X P(X) \right\vert_{X = α} =
\left. \frac{P(X)}{X - α} \right\vert_{X = α}
$$

*Proof.* Substitute $X = U + α$ with $\diff X = \frac{\delta U}{\delta X}\diff U = \diff U$:

$$
\left. \diff U P(U + α) \right\vert_{U = 0} =
\left. \frac{P(U + α)}{U} \right\vert_{U = 0}
$$

Write $S(U) = P(U + α)$ such that $S(0) = 0$ and $S(U) = s_1 U + s_2 U^2 + ⋯$.

$$
\begin{aligned}
\left. \diff U S(U) \right\vert_{U = 0} &=
\left. \frac{S(U)}{U} \right\vert_{U = 0}
\\\\
\left. \diff U \left(s_1 U + s_2 U^2 + ⋯ \right) \right\vert_{U = 0} &=
\left. \frac{s_1 U + s_2 U^2 + ⋯}{U} \right\vert_{U = 0}
\\\\
\left. \left(s_1 + 2 s_2 U + 3 s_3 U^2 ⋯ \right) \right\vert_{U = 0} &=
\left. \left(s_1 + s_2 U + s_3 U^2 ⋯ \right) \right\vert_{U = 0}
\\\\
s_1  &= s_1
\end{aligned}
$$
□

**Note.** The left-hand side expression does not depend on $α$, so the differentiated polynomial will give the divided out values wherever $P(X) = 0$. $P$ of $\deg P = n$ has at most $n$ roots and interpolates $n + 1$ points. $P'(X)$ has $\deg P' = n - 1$ and interpolates the $n$ roots and their associated divided out values.

**Corrolary.** *The formal derivative of a polynomial is the polynomial that interpolates all the 'divided out zeros'.*

**To do.** What if the the original polynomial contains zeros of higher multiplicity?

**To do.** What if the original polynomial contains irreducible factors of higher degree?

---

The above suggest a more general theorem:

**Lemma.** *Given $P ∈ \F[X]$ and $z ∈ \F$, the following holds:*

$$
\left. \diff X P(X) \right\vert_{X = z} =
\left. \frac{P(X) - P(z)}{X - z} \right\vert_{X = z}
$$

---

$$
P(X) = \prod_i (X - a_i)
$$

Can this be evaluated using dual numbers? See https://en.wikipedia.org/wiki/Dual_number .

Evaluate over $\F[\bar X,Ε]/(Ε^2)$ with $X = \bar X + Ε$:

$$
P(X) = \prod_i (\bar X + Ε - a_i)
$$

The result will be $P(\bar X) + \left(\diff {\bar X} P(\bar X)\right) E$, i.e. the first derivative will be the coefficient of $E$.

Using a higher cut-off $\F[\bar X,Ε]/(Ε^n)$, higher order derivates can be obtained.

The division function can be modified to automatically apply L'Hospital's rule when it faces a $\frac 00$ indeterminate. This allows an evaluation strategy that would normally fail suceed anyway when executed over the dual numbers.

Take for example the $i$-th Lagrange interpolants over $⟨ω⟩$

$$
\frac{X^n - 1}{X - ω^i}
$$

## Bivariate polynomials

$$
\def\F{\mathbb F}
$$

**Goal.** Simulate a form of (random access) memory using bivariate polynomials $P\in\F[X,Y]$.

Intuitively, we lay out the memory with time on the $X$ axis and space (addresses) on the $Y$ axis.

---

## Stack

Start with a simple stack where $P(ω_n^i, ω_m^j)$ is the value of stack location $j$ at time $i$.

The initial polynomial is the zero polynomial on our basis $ω^j$

$$
P(0, Y) = Y^m - 1
$$

**Note.** It looks like we can handle the memory sparsely, both in the polyonmial form and in the merkle trees.


$$
L_{m,j}(Y) = \frac{ω_m^j}{m} \frac{Y^m - 1}{Y-ω_m^j}
$$

### Push & Pop

**Constraint.** *(Push). Rotate all elements to the right, add an element $x$. Has the following constraints:*

$$
\begin{aligned}
P(X, ω_m^{m-1}) &= 0 \\\\
P(ω_n ⋅ X, Y) &= P(X, ω_m ⋅ Y) + x ⋅ L_0(Y)
\end{aligned}
$$

**Constraint.** *(Pop). Operate the push constraint in reverse.*

### Random access

**Constraint.** *(Compare and swap). Replace the value at $j$ from $a$ to $b$.*

$$
\begin{aligned}
P(X, ω_m^j) &= a \\\\
P(ω_n ⋅ X, Y) &= P(X, Y) + (b - a) ⋅ L_j(Y)
\end{aligned}
$$

The problem here is that we need to encode the $j$ somehow, either in a precomputed polynomial or as a column. Since all usage of $j$ will be in the form $ω_m^j$ we will use that instead. the final constraint will look like:

$$
\begin{aligned}
P(X, Q(X)) &= a \\\\
P(ω_n ⋅ X, Y) &= P(X, Y) + (b - a) ⋅ \frac{Q(X)}{m} \frac{Y^m - 1}{Y-Q(X)}
\end{aligned}
$$

**To do.** What if $Q(X)$ is not of the form $ω_m^j$?

The first constraint has a degree bound of $(\deg P)⋅(\deg Q) = n^2 m$. So far we have only handle constant constraint bounds. How do we LDE test this efficiently?

> We could add a temporary value? $t = Q(X), P(X, t) = a$?

In addition, to force $Q(X)$ to be a root of unity, we can add a constraint

$$
Q(X)^m = 1
$$

which has degree bound $m\deg Q = nm$. Again, how do we LDE-test this efficiently?

---

